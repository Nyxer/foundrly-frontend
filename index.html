<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Foundrly â€” Build Your AI Startup</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-purple: linear-gradient(to bottom right, #2d0059, #5e1aa2);
      --bg-gold: linear-gradient(to bottom right, #5f4200, #d4af37);
      --text-light: #ffffff;
      --text-dark: #1a1a1a;
      --accent-purple: #9b59b6;
      --accent-gold: #f1c40f;
      --metallic-purple: linear-gradient(145deg, #5e1aa2, #9b59b6);
      --metallic-gold: linear-gradient(145deg, #f1c40f, #d4af37);
      --ice-metallic-white: #d3e4f1;
      --metallic-black: #222222;
    }

    body.theme-purple { background: var(--bg-purple); color: var(--ice-metallic-white); }
    body.theme-gold   { background: var(--bg-gold);  color: var(--metallic-black); }

    body {
      font-family: 'Exo 2', sans-serif;
      margin: 0;
      padding: 4rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: auto;
      transition: background 0.5s ease, color 0.5s ease;
    }

    .typewriter-wrapper {
      position: fixed; top: 25%; left: 20%;
      width: 60vw; height: 60vh;
      pointer-events: none; z-index: 0;
      opacity: 0.2;
    }

    .typewriter-chat {
      position: absolute;
      background: rgba(0,0,0,0.3);
      color: var(--accent-purple);
      padding: 1.5rem;
      border-radius: 12px;
      font-size: 1rem;
      max-width: 300px;
      opacity: 0;
      animation: fadeInOut 6s ease-in-out forwards;
      white-space: pre-wrap;
    }
    body.theme-gold .typewriter-chat {
      background: rgba(255,255,255,0.2);
      color: var(--accent-gold);
    }

    @keyframes fadeInOut {
      0%,100% { opacity: 0; }
      10%,90% { opacity: 1; }
    }

    .title {
      font-family: 'Orbitron', sans-serif;
      font-size: 4rem;
      font-weight: 700;
      margin-bottom: 1rem; text-align: center;
      animation: fadeIn 1s ease;
      z-index: 2;
    }

    @keyframes fadeIn { from {opacity:0; transform:translateY(10px)} to {opacity:1; transform:translateY(0)} }

    body.theme-purple .title {
      background: linear-gradient(to right, #a770ef, #cf8bf3, #fdb99b);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    body.theme-gold .title {
      background: linear-gradient(to right, #d4af37, #eacb84);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    .slogan {
      font-size: 1.5rem;
      font-weight: 500;
      margin-bottom: 2rem;
      text-align: center; z-index: 2;
      animation: fadeInSlideUp 1.2s ease-in-out, glowPulse 1.5s ease-in-out infinite alternate;
    }

    @keyframes fadeInSlideUp {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes glowPulse {
      0% { text-shadow: 0 0 15px rgba(255, 255, 255, 0.7); }
      100% { text-shadow: 0 0 40px rgba(255, 255, 255, 1); }
    }

    .container {
      width: 100%; max-width: 800px;
      background: rgba(255,255,255,0.06);
      border-radius: 16px;
      padding: 3rem;
      box-shadow: 0 0 16px rgba(0, 0, 0, 0.5);
      z-index: 1;
      margin-bottom: 6rem;
    }

    #promptText {
      font-size: 1.2rem; margin-bottom: 1rem;
    }

    #ideaInput, .clarify-container input {
      width: 100%;
      padding: 1.25rem;
      font-size: 1.25rem;
      border-radius: 12px;
      border: 2px solid transparent;
      background: var(--metallic-purple);
      background-image: linear-gradient(145deg, rgba(0,0,0,0.1), rgba(255,255,255,0.1));
      background-size: cover;
      color: var(--ice-metallic-white);
      margin-bottom: 1.5rem;
      font-family: 'Exo 2', sans-serif;
      resize: none;
      transition: color 0.3s ease, border-color 0.3s ease;
      box-sizing: border-box;
    }

    body.theme-gold #ideaInput,
    body.theme-gold .clarify-container input {
      background: var(--metallic-gold);
      color: var(--metallic-black);
      border-color: transparent;
    }

    button {
      font-family: 'Exo 2', sans-serif;
      padding: 1rem 2rem;
      font-size: 1.2rem;
      font-weight: bold;
      background-image: var(--metallic-purple);
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      transition: transform 0.2s ease;
    }

    body.theme-gold button {
      background-image: var(--metallic-gold);
      color: var(--metallic-black);
    }

    button:hover { transform: scale(1.1); }

    #loader {
      display: none;
      margin: 2rem 0;
      text-align: center;
      font-size: 1.5rem;
    }

    #responseArea pre {
      background: rgba(155, 89, 182, 0.2);
      color: var(--ice-metallic-white);
      padding: 1.5rem;
      border-radius: 10px;
      white-space: pre-wrap;
      font-size: 1.2rem;
    }

    body.theme-gold #responseArea pre {
      background: rgba(241, 196, 15, 0.2);
      color: var(--metallic-black);
    }

    #settingsBtn {
      position: fixed;
      bottom: 80px;
      right: 16px;
      background: rgba(0, 0, 0, 0.6);
      color: #fff;
      padding: 0.75rem 1rem;
      font-size: 1.6rem;
      border-radius: 6px;
      cursor: pointer;
      z-index: 2;
    }

    #settingsPanel {
      display: none;
      position: fixed;
      bottom: 140px;
      right: 16px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 1.25rem;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      font-size: 1rem;
      z-index: 2;
    }

    .settings-toggle {
      display: inline-block;
      position: relative;
      width: 60px;
      height: 34px;
    }

    .settings-toggle input {
      opacity: 0; width: 0; height: 0;
    }

    .settings-toggle .slider {
      position: absolute;
      cursor: pointer;
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 34px;
    }

    .settings-toggle .slider:before {
      position: absolute;
      content: "";
      height: 26px; width: 26px;
      border-radius: 50%;
      left: 4px; bottom: 4px;
      background-color: white;
      transition: 0.4s;
    }

    input:checked + .slider {
      background-color: #2196F3;
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }
  </style>
</head>
<body class="theme-purple">

  <div class="typewriter-wrapper" id="typewriterWrapper"></div>
  <div class="title">Foundrly</div>
  <div class="slogan">Your Cofounder Doesnâ€™t Have to Be Human.</div>

  <div class="container">
    <div id="promptText">Describe your AI business idea:</div>
    <textarea id="ideaInput" placeholder="e.g. An AI that writes Instagram captions for barbers..."></textarea>
    <div class="clarify-container" id="clarifySection" style="display:none"></div>
    <button id="actionBtn" onclick="submitIdea()">Build It</button>
    <div id="loader">â³ Generating...</div>
    <div id="responseArea"></div>
  </div>

  <button id="settingsBtn" onclick="toggleSettings()">âš™ï¸</button>
  <div id="settingsPanel">
    <label for="themeToggle">ğŸŒ— Theme</label>
    <label class="settings-toggle">
      <input type="checkbox" id="themeToggle" onclick="toggleTheme()">
      <span class="slider"></span>
    </label>
    <label for="bgAnimToggle">ğŸï¸ Background Animation</label>
    <label class="settings-toggle">
      <input type="checkbox" id="bgAnimToggle" onclick="toggleBackgroundAnimation()">
      <span class="slider"></span>
    </label>
    <label for="fastTypingToggle">ğŸ–‹ï¸ Typing Speed</label>
    <label class="settings-toggle">
      <input type="checkbox" id="fastTypingToggle" onclick="toggleTypingSpeed()">
      <span class="slider"></span>
    </label>
    <label for="glowToggle">âœ¨ Reduce Glow</label>
    <label class="settings-toggle">
      <input type="checkbox" id="glowToggle" onclick="toggleGlow()">
      <span class="slider"></span>
    </label>
  </div>

  <script>
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 1. Fetch helper with timeout (default: 15 000 ms)
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    async function fetchWithTimeout(url, options = {}, timeout = 15000) {
      const controller = new AbortController();
      const id = setTimeout(() => controller.abort(), timeout);
      try {
        const res = await fetch(url, { ...options, signal: controller.signal });
        clearTimeout(id);
        return res;
      } catch (err) {
        clearTimeout(id);
        throw err;
      }
    }

    const phrases = [
      "An AI that writes ad copy for local cafes.",
      "A tool that builds landing pages from voice notes.",
      "An assistant that summarizes client feedback.",
      "An AI that auto-generates slogans for fashion brands.",
      "A bot that responds to DMs for digital creators.",
      "An AI that repackages blog posts into carousels.",
      "A caption creator for streetwear drops.",
      "Turn review comments into testimonials.",
      "Generate DM templates for influencer collabs.",
      "From idea to MVP, instantly."
    ];
    let typingSpeed = 'normal';
    let refineQuestions = [];
    let originalIdea = '';

    function spawnChatBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "typewriter-chat";
      bubble.style.left = `${Math.random() * 70 + 5}%`;
      bubble.style.top = `${Math.random() * 90 + 5}%`;
      document.getElementById("typewriterWrapper").appendChild(bubble);
      let i = 0;
      const interval = setInterval(() => {
        if (i < text.length) bubble.textContent += text[i++];
        else { clearInterval(interval); bubble.textContent += "."; setTimeout(() => bubble.remove(), 1000); }
      }, typingSpeed === 'fast' ? 30 : 45);
    }
    setInterval(() => spawnChatBubble(phrases[Math.floor(Math.random() * phrases.length)]), 2500);

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 2. Submits the idea and handles clarification
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    async function submitIdea() {
      originalIdea = document.getElementById("ideaInput").value.trim();
      if (!originalIdea) return;

      document.getElementById("loader").style.display = 'block';
      document.getElementById("responseArea").innerHTML = '';
      document.getElementById("clarifySection").style.display = 'none';
      document.getElementById("actionBtn").style.display = 'none';

      let data;
      try {
        const res = await fetchWithTimeout(
          "https://foundrly-backend-1.onrender.com/api/refine-idea",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ idea: originalIdea })
          },
          15000
        );
        data = await res.json();
      } catch (err) {
        return handleError(err);
      }

      document.getElementById("loader").style.display = 'none';

      if (data.status === "clarify") {
        refineQuestions = data.questions;
        const sec = document.getElementById("clarifySection");
        sec.innerHTML = '<h3>Letâ€™s clarify a few things:</h3>';
        refineQuestions.forEach((q, i) => {
          const inp = document.createElement("input");
          inp.placeholder = q;
          inp.id = `ans_${i}`;
          sec.appendChild(inp);
        });
        const btn = document.createElement("button");
        btn.textContent = "Submit Answers";
        btn.onclick = submitAnswers;
        sec.appendChild(btn);
        sec.style.display = 'block';

      } else if (data.status === "ready") {
        generateCode(originalIdea);

      } else {
        document.getElementById("responseArea").textContent = "Unexpected response.";
        document.getElementById("actionBtn").style.display = 'block';
      }
    }

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 3. Submit clarified answers
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    async function submitAnswers() {
      const answers = refineQuestions.map((_, i) => document.getElementById(`ans_${i}`).value.trim());
      const refined = originalIdea + ". " + answers.join(" ");
      document.getElementById("clarifySection").style.display = 'none';
      generateCode(refined);
    }

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 4. Generate code
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    async function generateCode(idea) {
      document.getElementById("loader").style.display = 'block';

      let data;
      try {
        const res = await fetchWithTimeout(
          "https://foundrly-backend-1.onrender.com/api/generate-code",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              idea,
              target_user: "creators",
              platform: "web app",
              features: ["text generation", "download"]
            })
          },
          30000
        );
        data = await res.json();
      } catch (err) {
        return handleError(err);
      }

      document.getElementById("loader").style.display = 'none';
      document.getElementById("responseArea").innerHTML = `
        <h3>Tool Summary:</h3><pre>${data.spec}</pre>
        <h3>Generated Code:</h3><pre>${data.code}</pre>
        <h3>Setup Instructions:</h3><pre>${data.instructions}</pre>`;
      document.getElementById("actionBtn").style.display = 'block';
      document.getElementById("promptText").textContent = "Describe your AI business idea:";
      document.getElementById("ideaInput").style.display = 'block';
    }

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 5. Shared error handler
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    function handleError(err) {
      console.error(err);
      document.getElementById("loader").style.display = 'none';
      document.getElementById("actionBtn").style.display = 'block';
      document.getElementById("ideaInput").style.display = 'block';
      document.getElementById("promptText").textContent = "Describe your AI business idea:";
      document.getElementById("clarifySection").style.display = 'none';

      document.getElementById("responseArea").textContent =
        err.name === 'AbortError'
          ? "ğŸ¤– Our AI got stuck in traffic! Try again shortly."
          : "âš ï¸ Something went wrong. Please try again.";
    }

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    // 6. Settings toggles
    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    function toggleSettings() {
      const p = document.getElementById("settingsPanel");
      p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }
    function toggleTheme() {
      document.body.classList.toggle("theme-purple");
      document.body.classList.toggle("theme-gold");
      localStorage.setItem("theme", document.body.classList.contains("theme-purple") ? "purple" : "gold");
    }
    function toggleBackgroundAnimation() {
      const w = document.getElementById("typewriterWrapper");
      w.style.display = w.style.display === 'none' ? 'block' : 'none';
      localStorage.setItem("bgAnim", w.style.display);
    }
    function toggleTypingSpeed() {
      typingSpeed = typingSpeed === 'normal' ? 'fast' : 'normal';
      localStorage.setItem("typingSpeed", typingSpeed);
    }
    function toggleGlow() {
      document.querySelector(".slogan").classList.toggle("no-glow");
      localStorage.setItem("glow", document.querySelector(".slogan").classList.contains("no-glow") ? "off" : "on");
    }

    window.onload = () => {
      if (localStorage.getItem("theme") === "gold") toggleTheme();
      if (localStorage.getItem("bgAnim") === "none") toggleBackgroundAnimation();
      if (localStorage.getItem("typingSpeed") === "fast") toggleTypingSpeed();
      if (localStorage.getItem("glow") === "off") toggleGlow();
    };
  </script>

</body>
</html>
